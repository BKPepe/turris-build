From fd34bbfcb88b74e2553db842757060e79d9255b1 Mon Sep 17 00:00:00 2001
From: Michal Hrusecky <michal.hrusecky@nic.cz>
Date: Wed, 28 Mar 2018 16:15:23 +0200
Subject: [PATCH] mvebu: omnia: Few tweaks to the basic configuration

Tweaking the defaults to be more suitable for us
---
 target/linux/mvebu/config-4.14        | 56 +++++++++++++++++++++++++++++++----
 target/linux/mvebu/image/cortex-a9.mk |  4 +--
 2 files changed, 52 insertions(+), 8 deletions(-)

diff --git a/target/linux/mvebu/config-4.14 b/target/linux/mvebu/config-4.14
index 5286bf9..2a751ef 100644
--- a/target/linux/mvebu/config-4.14
+++ b/target/linux/mvebu/config-4.14
@@ -65,13 +65,30 @@ CONFIG_ASYNC_TX_ENABLE_CHANNEL_SWITCH=y
 CONFIG_ATA=y
 CONFIG_ATAGS=y
 CONFIG_AUTO_ZRELADDR=y
+CONFIG_BINFMT_MISC=y
+CONFIG_BLK_CGROUP=y
 CONFIG_BLK_DEV_LOOP=y
 CONFIG_BLK_DEV_SD=y
 CONFIG_BLK_MQ_PCI=y
 CONFIG_BLK_SCSI_REQUEST=y
 CONFIG_BOUNCE=y
+CONFIG_BTRFS_FS=y
+# CONFIG_BTRFS_FS_CHECK_INTEGRITY is not set
+CONFIG_BTRFS_FS_POSIX_ACL=y
+CONFIG_BUILD_BIN2C=y
 # CONFIG_CACHE_FEROCEON_L2 is not set
 CONFIG_CACHE_L2X0=y
+CONFIG_CFS_BANDWIDTH=y
+CONFIG_CGROUPS=y
+CONFIG_CGROUP_BPF=y
+CONFIG_CGROUP_CPUACCT=y
+CONFIG_CGROUP_DEVICE=y
+CONFIG_CGROUP_FREEZER=y
+CONFIG_CGROUP_PIDS=y
+CONFIG_CGROUP_RDMA=y
+CONFIG_CGROUP_SCHED=y
+CONFIG_CGROUP_WRITEBACK=y
+CONFIG_CHECKPOINT_RESTORE=y
 CONFIG_CLKDEV_LOOKUP=y
 CONFIG_CLKSRC_ARM_GLOBAL_TIMER_SCHED_CLOCK=y
 CONFIG_CLKSRC_MMIO=y
@@ -79,6 +96,7 @@ CONFIG_CLONE_BACKWARDS=y
 CONFIG_COMMON_CLK=y
 CONFIG_CPUFREQ_DT=y
 CONFIG_CPUFREQ_DT_PLATDEV=y
+CONFIG_CPUSETS=y
 CONFIG_CPU_32v6K=y
 CONFIG_CPU_32v7=y
 CONFIG_CPU_ABRT_EV7=y
@@ -148,6 +166,7 @@ CONFIG_CRYPTO_SIMD=y
 CONFIG_CRYPTO_WORKQUEUE=y
 CONFIG_DCACHE_WORD_ACCESS=y
 CONFIG_DEBUG_ALIGN_RODATA=y
+# CONFIG_DEBUG_BLK_CGROUP is not set
 CONFIG_DEBUG_INFO=y
 CONFIG_DEBUG_LL=y
 CONFIG_DEBUG_LL_INCLUDE="debug/8250.S"
@@ -168,6 +187,7 @@ CONFIG_DMA_ENGINE_RAID=y
 # CONFIG_DMA_NOOP_OPS is not set
 CONFIG_DMA_OF=y
 # CONFIG_DMA_VIRT_OPS is not set
+CONFIG_DNOTIFY=y
 # CONFIG_DRM_LIB_RANDOM is not set
 CONFIG_DTC=y
 CONFIG_EARLY_PRINTK=y
@@ -176,14 +196,13 @@ CONFIG_EDAC_SUPPORT=y
 CONFIG_EXPORTFS=y
 CONFIG_EXT4_FS=y
 CONFIG_EXTCON=y
-# CONFIG_F2FS_CHECK_FS is not set
-CONFIG_F2FS_FS=y
-# CONFIG_F2FS_FS_SECURITY is not set
-CONFIG_F2FS_FS_XATTR=y
-CONFIG_F2FS_STAT_FS=y
+CONFIG_FAIR_GROUP_SCHED=y
+CONFIG_FANOTIFY=y
 CONFIG_FIXED_PHY=y
 CONFIG_FIX_EARLYCON_MEM=y
+CONFIG_FREEZER=y
 CONFIG_FS_MBCACHE=y
+CONFIG_FS_POSIX_ACL=y
 CONFIG_FUTEX_PI=y
 CONFIG_GENERIC_ALLOCATOR=y
 CONFIG_GENERIC_ARCH_TOPOLOGY=y
@@ -277,8 +296,11 @@ CONFIG_I2C_BOARDINFO=y
 CONFIG_I2C_CHARDEV=y
 CONFIG_I2C_MV64XXX=y
 # CONFIG_I2C_PXA is not set
+CONFIG_IKCONFIG=y
+CONFIG_IKCONFIG_PROC=y
 CONFIG_INITRAMFS_SOURCE=""
 CONFIG_IOMMU_HELPER=y
+CONFIG_IPC_NS=y
 CONFIG_IRQCHIP=y
 CONFIG_IRQ_DOMAIN=y
 CONFIG_IRQ_DOMAIN_DEBUG=y
@@ -309,6 +331,9 @@ CONFIG_MARVELL_PHY=y
 CONFIG_MDIO_BUS=y
 CONFIG_MDIO_DEVICE=y
 CONFIG_MDIO_I2C=y
+CONFIG_MEMCG=y
+CONFIG_MEMCG_SWAP=y
+# CONFIG_MEMCG_SWAP_ENABLED is not set
 CONFIG_MEMORY=y
 CONFIG_MIGHT_HAVE_CACHE_L2X0=y
 CONFIG_MIGHT_HAVE_PCI=y
@@ -321,6 +346,9 @@ CONFIG_MMC_SDHCI_PLTFM=y
 CONFIG_MMC_SDHCI_PXAV3=y
 # CONFIG_MMC_TIFM_SD is not set
 CONFIG_MODULES_USE_ELF_REL=y
+CONFIG_MODULE_FORCE_UNLOAD=y
+# CONFIG_MODULE_STRIPPED is not set
+CONFIG_MODVERSIONS=y
 CONFIG_MTD_CFI_STAA=y
 CONFIG_MTD_M25P80=y
 CONFIG_MTD_NAND=y
@@ -348,14 +376,17 @@ CONFIG_MVNETA_BM_ENABLE=y
 CONFIG_MVPP2=y
 CONFIG_MVSW61XX_PHY=y
 CONFIG_MV_XOR=y
+CONFIG_NAMESPACES=y
 CONFIG_NEED_DMA_MAP_STATE=y
 CONFIG_NEON=y
+# CONFIG_NET_CLS_CGROUP is not set
 CONFIG_NET_DSA=y
 CONFIG_NET_DSA_MV88E6XXX=y
 CONFIG_NET_DSA_MV88E6XXX_GLOBAL2=y
 CONFIG_NET_DSA_TAG_DSA=y
 CONFIG_NET_DSA_TAG_EDSA=y
 CONFIG_NET_FLOW_LIMIT=y
+CONFIG_NET_NS=y
 CONFIG_NET_SWITCHDEV=y
 CONFIG_NLS=y
 CONFIG_NOP_USB_XCEIV=y
@@ -379,6 +410,7 @@ CONFIG_ORION_WATCHDOG=y
 CONFIG_OUTER_CACHE=y
 CONFIG_OUTER_CACHE_SYNC=y
 CONFIG_PADATA=y
+CONFIG_PAGE_COUNTER=y
 CONFIG_PAGE_OFFSET=0xC0000000
 CONFIG_PCI=y
 CONFIG_PCI_DOMAINS=y
@@ -391,6 +423,7 @@ CONFIG_PGTABLE_LEVELS=2
 CONFIG_PHYLIB=y
 CONFIG_PHYLINK=y
 # CONFIG_PHY_MVEBU_CP110_COMPHY is not set
+CONFIG_PID_NS=y
 CONFIG_PINCTRL=y
 CONFIG_PINCTRL_ARMADA_370=y
 CONFIG_PINCTRL_ARMADA_38X=y
@@ -400,13 +433,16 @@ CONFIG_PINCTRL_MVEBU=y
 CONFIG_PJ4B_ERRATA_4742=y
 # CONFIG_PL310_ERRATA_588369 is not set
 # CONFIG_PL310_ERRATA_727915 is not set
-# CONFIG_PL310_ERRATA_753970 is not set
+CONFIG_PL310_ERRATA_753970=y
 # CONFIG_PL310_ERRATA_769419 is not set
 CONFIG_PLAT_ORION=y
 CONFIG_PM_OPP=y
 CONFIG_PRINTK_SAFE_LOG_BUF_SHIFT=11
+CONFIG_PROC_CHILDREN=y
+# CONFIG_PROC_PID_CPUSET is not set
 CONFIG_PWM=y
 CONFIG_PWM_SYSFS=y
+CONFIG_RAID6_PQ=y
 CONFIG_RATIONAL=y
 CONFIG_RCU_NEED_SEGCBLIST=y
 CONFIG_RCU_STALL_COMMON=y
@@ -423,6 +459,7 @@ CONFIG_RTC_DRV_ARMADA38X=y
 CONFIG_RTC_DRV_MV=y
 CONFIG_RTC_I2C_AND_SPI=y
 CONFIG_RTC_MC146818_LIB=y
+CONFIG_RT_GROUP_SCHED=y
 CONFIG_RWSEM_SPIN_ON_OWNER=y
 CONFIG_RWSEM_XCHGADD_ALGORITHM=y
 CONFIG_SATA_AHCI_PLATFORM=y
@@ -439,6 +476,7 @@ CONFIG_SFP=y
 CONFIG_SG_POOL=y
 CONFIG_SMP=y
 CONFIG_SMP_ON_UP=y
+CONFIG_SOCK_CGROUP_DATA=y
 CONFIG_SOC_BUS=y
 CONFIG_SPARSE_IRQ=y
 CONFIG_SPI=y
@@ -483,15 +521,21 @@ CONFIG_USB_SUPPORT=y
 CONFIG_USB_XHCI_HCD=y
 CONFIG_USB_XHCI_MVEBU=y
 CONFIG_USB_XHCI_PLATFORM=y
+CONFIG_USER_NS=y
 CONFIG_USE_OF=y
+CONFIG_UTS_NS=y
 CONFIG_VECTORS_BASE=0xffff0000
 CONFIG_VFP=y
 CONFIG_VFPv3=y
 CONFIG_WATCHDOG_CORE=y
+CONFIG_XOR_BLOCKS=y
 CONFIG_XPS=y
+CONFIG_XXHASH=y
 CONFIG_XZ_DEC_ARM=y
 CONFIG_XZ_DEC_BCJ=y
 CONFIG_ZBOOT_ROM_BSS=0x0
 CONFIG_ZBOOT_ROM_TEXT=0x0
 CONFIG_ZLIB_DEFLATE=y
 CONFIG_ZLIB_INFLATE=y
+CONFIG_ZSTD_COMPRESS=y
+CONFIG_ZSTD_DECOMPRESS=y
diff --git a/target/linux/mvebu/image/cortex-a9.mk b/target/linux/mvebu/image/cortex-a9.mk
index 8df6ba8..6598d86 100644
--- a/target/linux/mvebu/image/cortex-a9.mk
+++ b/target/linux/mvebu/image/cortex-a9.mk
@@ -151,8 +151,8 @@ define Device/turris-omnia
   KERNEL_INITRAMFS := kernel-bin
   DEVICE_TITLE := Turris Omnia
   DEVICE_PACKAGES :=  \
-    mkf2fs e2fsprogs kmod-fs-vfat kmod-nls-cp437 kmod-nls-iso8859-1 \
-    wpad-mini kmod-ath9k kmod-ath10k ath10k-firmware-qca988x
+    kmod-fs-btrfs btrfs-progs kmod-fs-vfat kmod-nls-cp437 kmod-nls-iso8859-1 \
+    wpad-full kmod-ath9k kmod-ath10k ath10k-firmware-qca988x kmod-wdt-orion
   DEVICE_DTS := armada-385-turris-omnia
 endef
 TARGET_DEVICES += turris-omnia
-- 
2.16.2

