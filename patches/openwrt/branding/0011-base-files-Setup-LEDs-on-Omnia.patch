From cd48142ae5be22860bad51da50658bf461b4592c Mon Sep 17 00:00:00 2001
From: Michal Hrusecky <Michal@Hrusecky.net>
Date: Tue, 24 Sep 2019 22:41:11 +0200
Subject: [PATCH] base-files: Setup LEDs on Omnia

---
 target/linux/mvebu/base-files/etc/board.d/02_network | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/target/linux/mvebu/base-files/etc/board.d/02_network b/target/linux/mvebu/base-files/etc/board.d/02_network
index 66d35dd..7654d3d 100755
--- a/target/linux/mvebu/base-files/etc/board.d/02_network
+++ b/target/linux/mvebu/base-files/etc/board.d/02_network
@@ -27,6 +27,15 @@ armada-xp-linksys-mamba)
 armada-385-turris-omnia)
 	ucidef_set_interface_lan "lan0 lan1 lan2 lan3 lan4"
 	ucidef_set_interface_wan "eth2"
+	ucidef_set_led_netdev "wan" "wan" "omnia-led:wan" "eth2"
+	for i in $(seq 1 3); do
+		wlan="$(ls -d /sys/bus/pci/devices/0000\:00\:0$i.0/000*/iee*/phy* | sed -n 's|.*/phy\([0-9]\)$|\1|p')"
+		if [ -n "$wlan" ]; then
+			ucidef_set_led_netdev "pci$i" "pci$i" "omnia-led:pci$i" "wlan$wlan"
+		else
+			ucidef_set_led_default "pci$i" "pci$i" "omnia-led:pci$i" "0"
+		fi
+	done
 	;;
 armada-388-clearfog-*)
 	# eth0 is standalone ethernet
-- 
2.23.0

