From e2f64bb884e1117cee23ab3ebfcdbb4d437a72d7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marek=20Beh=C3=BAn?= <marek.behun@nic.cz>
Date: Tue, 21 Dec 2021 00:35:45 +0100
Subject: [PATCH 12/12] mpc85xx: turris1x: Workaround fix for building turris1x
 kernel
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Marek Beh√∫n <marek.behun@nic.cz>
---
 target/linux/mpc85xx/config-5.15               |  2 +
 target/linux/mpc85xx/image/p2020.mk           |  1 +
 ...ootwrapper-disable-uImage-generation.patch | 42 -------------------
 3 files changed, 3 insertions(+), 42 deletions(-)
 delete mode 100644 target/linux/mpc85xx/patches-5.4/900-powerpc-bootwrapper-disable-uImage-generation.patch

diff --git a/target/linux/mpc85xx/config-5.15 b/target/linux/mpc85xx/config-5.15
index ee8f9a40ed..94a32358ae 100644
--- a/target/linux/mpc85xx/config-5.15
+++ b/target/linux/mpc85xx/config-5.15
@@ -327,3 +327,5 @@ CONFIG_USB_UAS=y
 CONFIG_SCSI=y
 CONFIG_BLK_DEV_SD=y
 CONFIG_MTD_NAND_ECC_SW_BCH=y
+# CONFIG_KERNEL_XZ is not set
+CONFIG_KERNEL_GZIP=y
diff --git a/target/linux/mpc85xx/image/p2020.mk b/target/linux/mpc85xx/image/p2020.mk
index e6ef38ff18..e5db995101 100644
--- a/target/linux/mpc85xx/image/p2020.mk
+++ b/target/linux/mpc85xx/image/p2020.mk
@@ -19,6 +19,7 @@ define Device/cznic_turris1x
   DEVICE_MODEL := Turris 1.x
   DEVICE_PACKAGES :=  \
     kmod-hwmon-core kmod-hwmon-lm90 kmod-usb3 kmod-rtc-ds1307 kmod-crypto-hw-talitos
+  KERNELNAME := uImage
   KERNEL = kernel-bin
 endef
 TARGET_DEVICES += cznic_turris1x
--
2.32.0

