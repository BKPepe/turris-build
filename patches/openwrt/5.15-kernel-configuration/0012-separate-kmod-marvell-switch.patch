From f9d8784bd6ab582e801454bcb752c3d4dd16ecb5 Mon Sep 17 00:00:00 2001
From: Josef Schlehofer <pepe.schlehofer@gmail.com>
Date: Mon, 27 Jun 2022 14:22:16 +0200
Subject: [PATCH] Try this for Marvell switches. We will see

---
 package/kernel/linux/modules/dsa.mk | 49 +++++++++++++++++++++++++++++
 1 file changed, 49 insertions(+)
 create mode 100644 package/kernel/linux/modules/dsa.mk

diff --git a/package/kernel/linux/modules/dsa.mk b/package/kernel/linux/modules/dsa.mk
new file mode 100644
index 0000000000..4df86325b3
--- /dev/null
+++ b/package/kernel/linux/modules/dsa.mk
@@ -0,0 +1,49 @@
+DSA_MENU:=DSA Support
+
+define KernelPackage/dsa
+  SUBMENU:=$(DSA_MENU)
+  TITLE:=DSA support
+  KCONFIG:=\
+	CONFIG_NET_DSA \
+	CONFIG_NET_SWITCHDEV=y \
+	CONFIG_NET_DSA_HWMON=n
+  DEPENDS:=+kmod-libphy
+ifeq ($(CONFIG_OF),y)
+  DEPENDS+=+kmod-of-mdio
+endif
+  FILES:=$(LINUX_DIR)/net/dsa/dsa_core.ko
+  AUTOLOAD:=$(call AutoLoad,34,dsa_core)
+endef
+
+define KernelPackage/dsa/description
+ Kernel module for DSA support.
+endef
+
+$(eval $(call KernelPackage,dsa))
+
+
+define AddDepends/dsa
+  SUBMENU:=$(DSA_MENU)
+  DEPENDS+=kmod-dsa $(1)
+endef
+
+
+define KernelPackage/dsa-mv88e6xxx
+  TITLE:=Marvell 88E6XXX switch support
+  KCONFIG:=CONFIG_NET_DSA_MV88E6XXX
+  FILES:=$(LINUX_DIR)/drivers/net/dsa/mv88e6xxx/mv88e6xxx.ko
+  AUTOLOAD:=$(call AutoLoad,34,mv88e6xxx)
+  $(call AddDepends/dsa)
+endef
+
+define KernelPackage/dsa-mv88e6xxx/description
+  This enables support for the Marvell 88E6XXX ethernet switch chips.
+endef
+
+$(eval $(call KernelPackage,dsa-mv88e6xxx))
+
+define AddDepends/dsa-mv88e6xxx
+  SUBMENU:=$(DSA_MENU)
+  DEPENDS+=kmod-dsa kmod-dsa-mv88e6xxx $(1)
+endef
+
-- 
2.34.1

