From 799f50cce1d20076a067d3606da6f0036e5f94f2 Mon Sep 17 00:00:00 2001
From: Michal Hrusecky <michal.hrusecky@nic.cz>
Date: Wed, 12 Dec 2018 15:08:45 +0100
Subject: [PATCH] mariadb: Use more sane default path

Let's set default paths in a way that makes sense.

Signed-off-by: Michal Hrusecky <Michal@Hrusecky.net>
---
 utils/mariadb/Makefile | 30 ++++++++++--------------------
 1 file changed, 10 insertions(+), 20 deletions(-)

diff --git a/utils/mariadb/Makefile b/utils/mariadb/Makefile
index 93d6dfe1c..ab9dec946 100644
--- a/utils/mariadb/Makefile
+++ b/utils/mariadb/Makefile
@@ -33,7 +33,7 @@ PKG_BUILD_DEPENDS:=libevent2 mariadb/host
 
 CMAKE_INSTALL:=1
 
-PLUGIN_DIR:=/usr/lib/mysql/plugin
+PLUGIN_DIR:=/usr/lib/mariadb/plugin
 
 MARIADB_COMMON_DEPENDS := \
 	+libatomic \
@@ -339,20 +339,11 @@ CMAKE_OPTIONS += \
 	-DDISABLE_SHARED=NO \
 	-DENABLED_PROFILING=OFF \
 	-DENABLE_STATIC_LIBS=OFF \
-	-DINSTALL_DOCDIR=share/doc/mariadb \
-	-DINSTALL_DOCREADMEDIR=share/doc/mariadb \
-	-DINSTALL_MANDIR=share/man \
-	-DINSTALL_MYSQLSHAREDIR=share/mysql \
-	-DINSTALL_MYSQLTESTDIR="" \
-	-DINSTALL_PLUGINDIR=lib/mysql/plugin \
-	-DINSTALL_SBINDIR=bin \
-	-DINSTALL_SCRIPTDIR=bin \
-	-DINSTALL_SQLBENCHDIR="" \
-	-DINSTALL_SUPPORTFILESDIR=share/mysql \
-	-DINSTALL_UNIX_ADDRDIR=/var/run/mysqld/mysqld.sock \
-	-DMYSQLD_USER=mariadb \
-	-DMYSQL_DATADIR=/var/lib/mysql \
-	-DMYSQL_UNIX_ADDR=/var/run/mysqld/mysqld.sock \
+    -DINSTALL_MYSQLSHAREDIR=share/mariadb \
+    -DINSTALL_LAYOUT=RPM \
+    -DINSTALL_PLUGINDIR=lib/mariadb/plugin \
+    -DINSTALL_MYSQLDATADIR=/srv/mysql \
+    -DINSTALL_UNIX_ADDRDIR=/var/run/mysql.sock
 	-DSKIP_TESTS=ON \
 	-DWITH_ASAN=OFF \
 	-DWITH_EMBEDDED_SERVER=OFF \
@@ -430,19 +421,18 @@ define Host/Install
 endef
 
 define Build/InstallDev
-	$(INSTALL_DIR) $(2)/bin $(1)/usr/bin $(1)/usr/include $(1)/usr/lib/mysql $(1)/usr/lib/pkgconfig $(1)/usr/share/aclocal
+	$(INSTALL_DIR) $(2)/bin $(1)/usr/bin $(1)/usr/include $(1)/usr/lib $(1)/usr/lib/pkgconfig $(1)/usr/share/aclocal
 	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/mysql_config $(1)/usr/bin
 	$(LN) $(STAGING_DIR)/usr/bin/mysql_config $(2)/bin
 	$(CP) $(PKG_INSTALL_DIR)/usr/include/mysql $(1)/usr/include
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/libmysqlclient*.so* $(1)/usr/lib
-	cd $(1)/usr/lib/mysql; $(LN) ../libmysqlclient*.so* .
+	$(CP) $(PKG_INSTALL_DIR)/usr/lib*/libmysqlclient*.so* $(1)/usr/lib
 	$(INSTALL_DATA) $(PKG_INSTALL_DIR)/usr/share/pkgconfig/mariadb.pc $(1)/usr/lib/pkgconfig
 	$(INSTALL_DATA) $(PKG_INSTALL_DIR)/usr/share/aclocal/mysql.m4 $(1)/usr/share/aclocal
 endef
 
 define Package/libmariadbclient/install
 	$(INSTALL_DIR) $(1)$(PLUGIN_DIR)
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/libmysqlclient*.so* $(1)/usr/lib
+	$(CP) $(PKG_INSTALL_DIR)/usr/lib*/libmysqlclient*.so* $(1)/usr/lib
 	$(INSTALL_BIN) $(PKG_INSTALL_DIR)$(PLUGIN_DIR)/dialog.so $(1)$(PLUGIN_DIR)
 	$(INSTALL_BIN) $(PKG_INSTALL_DIR)$(PLUGIN_DIR)/mysql_clear_password.so $(1)$(PLUGIN_DIR)
 endef
@@ -493,7 +483,7 @@ define Package/mariadb-server-extra/install
 endef
 
 define Package/mariadb-server/conffiles
-/etc/mysql/my.cnf
+/etc/my.cnf
 $(PLUGIN_DIR)/daemon_example.ini
 endef
 
-- 
2.19.2

